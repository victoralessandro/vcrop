var VCrop=function(){function g(b){if(this.options={width:0,height:0,selector:{width:0,height:0,minWidth:0,minHeight:0,maxWidth:0,maxHeight:0},proportion:null,image:new Image,container:null,aspectRatio:null,resizable:!0},this.selectionArea={x:0,y:0,width:0,height:0},this.options=n(this.options,b),this.selectionArea.width=this.options.selector.width,this.selectionArea.height=this.options.selector.height,this.options.container.appendChild(a),this.options.image.crossOrigin="anonymous",null!=this.options.aspectRatio){var c=this.options.aspectRatio.split(":");if(c[0]=parseInt(c[0]),c[1]=parseInt(c[1]),c[0]/c[1]!=this.selectionArea.width/this.selectionArea.height)throw"Selector size problem";this.options.aspectRatio=c}}function h(b){mouseIsDown=!0,d=r(a,b)}function i(a){d=null,e=null}function j(b){if(c=r(a,b),null!=e)return void e.call();var g=("Mouse position: "+c.x+","+c.y,this.selectionArea.x),h=this.selectionArea.y,i=this.selectionArea.width,j=this.selectionArea.height;if(c.x>=this.selectionArea.x+5&&c.x<=this.selectionArea.x+this.selectionArea.width-5&&c.y>=this.selectionArea.y+5&&c.y<=this.selectionArea.y+this.selectionArea.height-5)a.style.cursor="move",null!=d&&(e=l.bind(this));else{if(!this.options.resizable)return void(a.style.cursor="default");a.style.cursor="default",k(c.x,g-5,g+5)&&k(c.y,h+5,h+j-5)?(a.style.cursor="w-resize",null!=d&&(e=m.bind(this,"w","l"))):k(c.x,g+i-5,g+i+5)&&k(c.y,h+5,h+j-5)?(a.style.cursor="w-resize",null!=d&&(e=m.bind(this,"w","r"))):k(c.y,h-5,h+5)&&k(c.x,g+5,g+i-5)?(a.style.cursor="n-resize",null!=d&&(e=m.bind(this,"h","t"))):k(c.y,h+j-5,h+j+5)&&k(c.x,g+5,g+i-5)?(a.style.cursor="n-resize",null!=d&&(e=m.bind(this,"h","b"))):k(c.x,g-5,g+5)&&k(c.y,h-5,h+5)?(a.style.cursor="se-resize",null!=d&&(e=m.bind(this,"wh","tl"))):k(c.x,g+i-5,g+i+5)&&k(c.y,h+j-5,h+j+5)?(a.style.cursor="se-resize",null!=d&&(e=m.bind(this,"wh","br"))):k(c.x,g-5,g+5)&&k(c.y,h+j-5,h+j+5)?(a.style.cursor="sw-resize",null!=d&&(e=m.bind(this,"wh","bl"))):k(c.x,g+i-5,g+i+5)&&k(c.y,h-5,h+5)&&(a.style.cursor="sw-resize",null!=d&&(e=m.bind(this,"wh","tr")))}null!=e&&e.call()}function k(a,b,c,d=true){return d?a>=b&&a<=c:a>b&&a<c}function l(){var a=d.x-c.x,b=d.y-c.y,e={x:this.selectionArea.x-a,y:this.selectionArea.y-b};this.selectionArea.x=e.x>=0?e.x+this.selectionArea.width<=this.options.image.width?e.x:this.options.image.width-this.selectionArea.width:0,this.selectionArea.y=e.y>=0?e.y+this.selectionArea.height<=this.options.image.height?e.y:this.options.image.height-this.selectionArea.height:0,d.x=c.x,d.y=c.y,p.call(this)}function m(a,b){var e=Object.assign({},this.selectionArea);if("w"==a)if("l"==b){var f=this.selectionArea.x;this.selectionArea.x=c.x,this.selectionArea.width=this.selectionArea.width+(f-c.x)}else this.selectionArea.width=this.selectionArea.width-(d.x-c.x);else if("h"==a)if("t"==b){var f=this.selectionArea.y;this.selectionArea.y=c.y,this.selectionArea.height=this.selectionArea.height+(f-c.y)}else this.selectionArea.height=this.selectionArea.height-(d.y-c.y);else if("wh"==a)if("tl"==b){var g=this.selectionArea.x;this.selectionArea.x=c.x,this.selectionArea.width=this.selectionArea.width+(g-c.x);var h=this.selectionArea.y;this.selectionArea.y=c.y,this.selectionArea.height=this.selectionArea.height+(h-c.y)}else if("br"==b)this.selectionArea.width=this.selectionArea.width-(d.x-c.x),this.selectionArea.height=this.selectionArea.height-(d.y-c.y);else if("bl"==b){var g=this.selectionArea.x;this.selectionArea.x=c.x,this.selectionArea.width=this.selectionArea.width+(g-c.x),this.selectionArea.height=this.selectionArea.height-(d.y-c.y)}else if("tr"==b){this.selectionArea.width=this.selectionArea.width-(d.x-c.x);var h=this.selectionArea.y;this.selectionArea.y=c.y,this.selectionArea.height=this.selectionArea.height+(h-c.y)}null!=this.options.aspectRatio&&("w"==a?this.selectionArea.height=this.selectionArea.width*this.options.aspectRatio[1]/this.options.aspectRatio[0]:"h"==a?this.selectionArea.width=this.selectionArea.height*this.options.aspectRatio[0]/this.options.aspectRatio[1]:this.selectionArea.width<this.selectionArea.height?this.selectionArea.height=this.selectionArea.width*this.options.aspectRatio[1]/this.options.aspectRatio[0]:this.selectionArea.width=this.selectionArea.height*this.options.aspectRatio[0]/this.options.aspectRatio[1]),(this.selectionArea.x+this.selectionArea.width>this.options.width||this.selectionArea.y+this.selectionArea.height>this.options.height)&&(this.selectionArea=e),d.x=c.x,d.y=c.y,p.call(this)}function n(a,b){var c=Object.create(a);for(var d in b)void 0!==c[d]&&null!=b[d]&&(c[d]=b[d]);return c}function o(){b.setLineDash([5]),b.rect(this.selectionArea.x,this.selectionArea.y,this.selectionArea.width,this.selectionArea.height),b.stroke()}function p(){a.width=this.options.image.width,a.height=this.options.image.height,b.drawImage(this.options.image,0,0),o.call(this)}function q(a,b,c){var d=100*b/a;return d*c/100}function r(a,b){var c=a.getBoundingClientRect();return{x:b.clientX-c.left,y:b.clientY-c.top}}function s(a){if(f.indexOf(a.split(".").pop())==-1){var b="Image must be png or jpg";throw b}return!0}var a=document.createElement("canvas"),b=a.getContext("2d"),c={x:0,y:0},d=null,e=null,f=["jpg","png"];return g.prototype.crop=function(){var a=document.createElement("canvas"),b=a.getContext("2d");return a.width=this.selectionArea.width,a.height=this.selectionArea.height,b.drawImage(this.options.image,this.selectionArea.x,this.selectionArea.y,this.selectionArea.width,this.selectionArea.height,0,0,this.selectionArea.width,this.selectionArea.height),a.toDataURL()},g.prototype.setImage=function(b){var c="";if("object"==typeof b&&void 0!==b.name)s(b.name),c=URL.createObjectURL(b);else{if("string"!=typeof b)throw"Parameter is not either a file or a valid url";s(b),c=b}var d=this;this.options.image.src=c,this.options.image.onload=function(){var b=this.width,c=this.height;if(this.width>d.options.width||this.height>d.options.height){this.width>this.height?(b=d.options.width,c=q(this.width,d.options.width,this.height)):(c=d.options.height,b=q(this.height,d.options.height,this.width));var e=document.createElement("canvas"),f=e.getContext("2d");return e.width=b,e.height=c,f.drawImage(this,0,0,b,c),void(d.options.image.src=e.toDataURL())}d.options.width=b,d.options.height=c,p.call(d),a.addEventListener("mousemove",j.bind(d)),a.addEventListener("mousedown",h.bind(this),!1),a.addEventListener("mouseup",i.bind(this),!1)},this.options.image.onerror=function(a){console.error("An error ocurre while loading the image",a)}},g}();